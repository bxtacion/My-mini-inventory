<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mini Inventory</title>
<style>
  :root{--gap:14px;--radius:14px}
  *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  body{margin:0;background:#f6f7fb;color:#222}
  header{padding:18px 16px 6px}
  h1{margin:0;font-size:26px;letter-spacing:.3px}
  .container{padding:0 16px 24px}
  .card{background:#fff;border-radius:var(--radius);padding:var(--gap);box-shadow:0 6px 18px rgba(0,0,0,.07);margin-bottom:var(--gap)}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap}
  input,select,button{width:100%;padding:12px;border:1px solid #e1e4ec;border-radius:12px;font-size:16px}
  input:focus{outline:none;border-color:#6c8bff;box-shadow:0 0 0 3px rgba(108,139,255,.18)}
  button{border:none;background:#4c6fff;color:#fff;font-weight:600;cursor:pointer}
  button.secondary{background:#e9edff;color:#334}
  button.ghost{background:#fff;border:1px dashed #ccd3ff;color:#445}
  button.danger{background:#ff595e}
  label{font-size:13px;color:#333;display:block;margin-bottom:6px}
  .grid{display:grid;grid-template-columns:1fr;gap:var(--gap)}
  @media (min-width:720px){.grid{grid-template-columns:repeat(2,1fr)}}
  .full{grid-column:1 / -1}
  table{width:100%;border-collapse:collapse}
  th,td{padding:12px 10px;border-bottom:1px solid #eee;font-size:14px}
  th{background:#fafbff;text-align:left;position:sticky;top:0;z-index:1}
  .tag{display:inline-block;background:#eef2ff;border-radius:999px;padding:2px 8px;font-size:12px}
  .muted{color:#666;font-size:12px}
  .actions{display:flex;gap:6px}
  tr.low td{background:#fff3cd}
  .table-wrap{overflow:auto;max-height:58vh}
  footer{padding:10px 16px;color:#888;font-size:12px;text-align:center}
</style>
</head>
<body>
  <header>
    <h1>üì¶ Mini Inventory</h1>
  </header>
  <div class="container">

    <div class="card">
      <div class="toolbar">
        <input id="search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: ‡∏ä‡∏∑‡πà‡∏≠ / SKU / ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà">
        <select id="sort">
          <option value="updated_desc">‡πÄ‡∏£‡∏µ‡∏¢‡∏á: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</option>
          <option value="name_asc">‡πÄ‡∏£‡∏µ‡∏¢‡∏á: ‡∏ä‡∏∑‡πà‡∏≠ (‡∏Å-‡∏Æ)</option>
          <option value="stock_asc">‡πÄ‡∏£‡∏µ‡∏¢‡∏á: ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ô‡πâ‡∏≠‡∏¢‚Äì‡∏°‡∏≤‡∏Å</option>
        </select>
        <button id="btn-export" class="secondary" title="‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô JSON">Export JSON</button>
        <input id="file-import" type="file" accept="application/json" style="display:none">
        <button id="btn-import" class="ghost">Import JSON</button>
        <button id="btn-clear" class="danger">‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
      </div>
      <div class="muted" style="margin-top:6px">* Low stock = ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‚â§ Threshold</div>
    </div>

    <div class="card">
      <div class="grid">
        <div class="full"><strong>+ ‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</strong></div>
        <div>
          <label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ *</label>
          <input id="name" required>
        </div>
        <div>
          <label>SKU *</label>
          <input id="sku" required>
        </div>
        <div>
          <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
          <input id="category" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏õ‡∏π‡∏ô, ‡πÄ‡∏´‡∏•‡πá‡∏Å, ‡∏™‡∏µ">
        </div>
        <div>
          <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢</label>
          <input id="unit" placeholder="‡∏ñ‡∏∏‡∏á, ‡πÅ‡∏ó‡πà‡∏á, ‡∏Å‡∏•.">
        </div>
        <div>
          <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏∏‡∏ô</label>
          <input id="cost" type="number" min="0" step="0.01" inputmode="decimal">
        </div>
        <div>
          <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</label>
          <input id="price" type="number" min="0" step="0.01" inputmode="decimal">
        </div>
        <div>
          <label>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</label>
          <input id="stock" type="number" min="0" step="1" value="0" inputmode="numeric">
        </div>
        <div>
          <label>Threshold (‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô)</label>
          <input id="threshold" type="number" min="0" step="1" value="5" inputmode="numeric">
        </div>
        <div class="full" style="display:flex;gap:8px">
          <button id="btn-save" class="primary" style="flex:1">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          <button id="btn-reset" class="secondary" style="flex:1">‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
        </div>
      </div>
      <input type="hidden" id="editingId">
    </div>

    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</strong>
      </div>
      <div class="table-wrap">
        <table id="tbl">
          <thead>
            <tr>
              <th>‡∏ä‡∏∑‡πà‡∏≠</th>
              <th>SKU</th>
              <th>‡∏´‡∏°‡∏ß‡∏î</th>
              <th>‡∏Ç‡∏≤‡∏¢/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
              <th>‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
              <th>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï</th>
              <th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div id="empty" class="muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</div>
    </div>

  </div>
  <footer>Made for your portfolio ‚ú®</footer>

<script>
(function(){
  const KEY = 'mini_inventory_v2';
  const $ = (id)=>document.getElementById(id);

  const state = {
    items: load(),
    query: '',
    sort: 'updated_desc'
  };

  function load(){
    try{
      const raw = localStorage.getItem(KEY);
      return raw ? JSON.parse(raw) : [];
    }catch(e){ return []; }
  }
  function save(){ localStorage.setItem(KEY, JSON.stringify(state.items)); }
  function uid(){ return (crypto.randomUUID && crypto.randomUUID()) || ('id_'+Date.now()+Math.random().toString(16).slice(2)); }
  function fmtMoney(v){ if(v==null||v==='') return '-'; return Number(v).toLocaleString('th-TH',{maximumFractionDigits:2}); }
  function escapeHtml(s){ return (s??'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

  function upsert(item){
    const i = state.items.findIndex(x=>x.id===item.id);
    if(i>-1) state.items[i]=item; else state.items.push(item);
    save(); render();
  }
  function removeItem(id){ state.items = state.items.filter(x=>x.id!==id); save(); render(); }

  function render(){
    const q = state.query.toLowerCase();
    let rows = state.items.filter(x =>
      [x.name,x.sku,x.category].some(v => (v||'').toLowerCase().includes(q))
    );

    switch(state.sort){
      case 'name_asc': rows.sort((a,b)=> (a.name||'').localeCompare(b.name||'')); break;
      case 'stock_asc': rows.sort((a,b)=> (a.stock||0) - (b.stock||0)); break;
      default: rows.sort((a,b)=> (b.updatedAt||0) - (a.updatedAt||0));
    }

    const tb = document.querySelector('#tbl tbody');
    tb.innerHTML = '';
    rows.forEach(x=>{
      const tr = document.createElement('tr');
      if((x.stock??0) <= (x.threshold??0)) tr.classList.add('low');
      tr.innerHTML = `
        <td>${escapeHtml(x.name)}</td>
        <td><span class="tag">${escapeHtml(x.sku)}</span></td>
        <td>${escapeHtml(x.category||'-')}</td>
        <td>${fmtMoney(x.price)} / ${escapeHtml(x.unit||'-')}</td>
        <td>${x.stock??0} ${escapeHtml(x.unit||'')}</td>
        <td>${new Date(x.updatedAt||Date.now()).toLocaleString('th-TH')}</td>
        <td class="actions">
          <button data-act="edit" data-id="${x.id}" class="secondary">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
          <button data-act="del"  data-id="${x.id}" class="danger">‡∏•‡∏ö</button>
        </td>`;
      tb.appendChild(tr);
    });

    $('empty').style.display = rows.length ? 'none' : 'block';
  }

  // Save
  $('btn-save').addEventListener('click', (e)=>{
    const item = {
      id: $('editingId').value || uid(),
      name: $('name').value.trim(),
      sku: $('sku').value.trim(),
      category: $('category').value.trim(),
      unit: $('unit').value.trim(),
      cost: +$('cost').value || 0,
      price: +$('price').value || 0,
      stock: +$('stock').value || 0,
      threshold: +$('threshold').value || 0,
      updatedAt: Date.now()
    };
    if(!item.name || !item.sku){ alert('‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞ SKU'); return; }
    upsert(item);
    clearForm();
    window.scrollTo({top:0,behavior:'smooth'});
  });

  function clearForm(){
    ['name','sku','category','unit','cost','price','stock','threshold','editingId'].forEach(id=>{$(id).value = ''});
    $('stock').value = 0; $('threshold').value = 5;
  }

  $('btn-reset').onclick = clearForm;

  document.querySelector('#tbl').addEventListener('click', (e)=>{
    const btn = e.target.closest('button'); if(!btn) return;
    const id = btn.dataset.id;
    const item = state.items.find(x=>x.id===id);
    if(btn.dataset.act==='edit' && item){
      $('editingId').value = item.id;
      $('name').value = item.name || '';
      $('sku').value = item.sku || '';
      $('category').value = item.category || '';
      $('unit').value = item.unit || '';
      $('cost').value = item.cost ?? '';
      $('price').value = item.price ?? '';
      $('stock').value = item.stock ?? 0;
      $('threshold').value = item.threshold ?? 5;
      window.scrollTo({top:0,behavior:'smooth'});
    }
    if(btn.dataset.act==='del'){
      if(confirm('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?')) removeItem(id);
    }
  });

  $('search').addEventListener('input', e=>{ state.query = e.target.value; render(); });
  $('sort').addEventListener('change', e=>{ state.sort = e.target.value; render(); });

  $('btn-export').onclick = ()=>{
    const blob = new Blob([JSON.stringify(state.items,null,2)],{type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'inventory.json';
    a.click();
    URL.revokeObjectURL(a.href);
  };

  $('btn-import').onclick = ()=>$('file-import').click();
  $('file-import').addEventListener('change', async (e)=>{
    const file = e.target.files[0]; if(!file) return;
    try{
      const text = await file.text();
      const arr = JSON.parse(text);
      if(Array.isArray(arr)){
        state.items = arr.filter(Boolean).map(x=>({
          id: x.id || uid(),
          name: String(x.name||''),
          sku: String(x.sku||''),
          category: x.category||'',
          unit: x.unit||'',
          cost: Number(x.cost||0),
          price: Number(x.price||0),
          stock: Number(x.stock||0),
          threshold: Number(x.threshold||0),
          updatedAt: Number(x.updatedAt||Date.now())
        }));
        save(); render();
      }else alert('‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
    }catch{ alert('‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ'); }
    e.target.value = '';
  });

  $('btn-clear').onclick = ()=>{
    if(confirm('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')){ state.items=[]; save(); render(); }
  };

  render();
})();
</script>
</body>
</html>
